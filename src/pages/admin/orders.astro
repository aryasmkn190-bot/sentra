---
import AdminLayout from '../../layouts/AdminLayout.astro';
import { db } from '../../lib/db';
import { orders } from '../../lib/schema';
import { desc } from 'drizzle-orm';
import { getAdminUser, getAllowedOffices } from '../../lib/auth';

const adminUser = getAdminUser(Astro.request);
const allowedOffices = getAllowedOffices(Astro.request);
const isSuperAdmin = adminUser?.role === 'super_admin';

let allOrders: any[] = [];
try {
  let fetchedOrders = await db.select().from(orders).orderBy(desc(orders.createdAt));
  
  // Filter orders by allowed offices for regular admins
  if (allowedOffices !== null) {
    fetchedOrders = fetchedOrders.filter(o => allowedOffices.includes(o.kelompok));
  }
  
  allOrders = fetchedOrders;
} catch (error) {
  console.error('Error fetching orders:', error);
}

const statusColors: Record<string, string> = {
  pending: 'warning',
  confirmed: 'info',
  processing: 'info',
  completed: 'success',
  cancelled: 'danger',
};

const statusLabels: Record<string, string> = {
  pending: 'Menunggu',
  confirmed: 'Dikonfirmasi',
  processing: 'Diproses',
  completed: 'Selesai',
  cancelled: 'Dibatalkan',
};

// Get unique kelompok values from filtered orders
const kelompokList = [...new Set(allOrders.map(o => o.kelompok))].sort();
---

<AdminLayout title="Kelola Pesanan" activeMenu="orders">
  <!-- Search Bar -->
  <div class="search-bar">
    <div class="search-input-wrapper">
      <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
      <input type="text" class="search-input" id="searchInput" placeholder="Cari nama, no. order, atau no. WA..." autocomplete="off" />
      <button class="search-clear-btn" id="searchClearBtn" title="Hapus pencarian" style="display:none;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
        </svg>
      </button>
    </div>
    <div class="search-result-info" id="searchResultInfo" style="display:none;"></div>
  </div>

  <!-- Filters Row -->
  <div class="filters-bar">
    <div class="filters-left">
      <!-- Status Filters -->
      <div class="orders-filters" id="filtersScroll">
        <button class="filter-chip active" data-filter="all">Semua <span class="filter-count">{allOrders.length}</span></button>
        <button class="filter-chip" data-filter="pending">‚è≥ Menunggu <span class="filter-count">{allOrders.filter(o => o.status === 'pending').length}</span></button>
        <button class="filter-chip" data-filter="confirmed">‚úÖ Konfirmasi <span class="filter-count">{allOrders.filter(o => o.status === 'confirmed').length}</span></button>
        <button class="filter-chip" data-filter="processing">üîÑ Proses <span class="filter-count">{allOrders.filter(o => o.status === 'processing').length}</span></button>
        <button class="filter-chip" data-filter="completed">üéâ Selesai <span class="filter-count">{allOrders.filter(o => o.status === 'completed').length}</span></button>
        <button class="filter-chip" data-filter="cancelled">‚ùå Batal <span class="filter-count">{allOrders.filter(o => o.status === 'cancelled').length}</span></button>
      </div>
    </div>
    <div class="filters-right">
      <!-- Kelompok Filter -->
      <select class="kelompok-filter" id="kelompokFilter">
        <option value="all">üè¢ Semua Kantor</option>
        {kelompokList.map(k => (
          <option value={k}>{k}</option>
        ))}
      </select>
    </div>
  </div>

  <!-- Bulk Action Bar -->
  <div class="bulk-bar" id="bulkBar">
    <div class="bulk-bar-inner">
      <label class="bulk-select-all-label">
        <input type="checkbox" id="selectAllCheckbox" />
        <span>Pilih Semua</span>
      </label>
      <span class="bulk-count" id="bulkCount">0 dipilih</span>
      <button class="btn btn-danger-outline btn-sm" id="bulkDeleteBtn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
        Hapus Terpilih
      </button>
    </div>
  </div>

  {allOrders.length > 0 ? (
    <>
      {/* Desktop Table */}
      <div class="table-wrapper desktop-view">
        <table class="table" id="ordersTable">
          <thead>
            <tr>
              <th class="th-check">
                <input type="checkbox" class="order-check-all" id="desktopCheckAll" title="Pilih Semua" />
              </th>
              <th>No. Order</th>
              <th>Pelanggan</th>
              <th>Kantor</th>
              <th>Item</th>
              <th>Total</th>
              <th>WA</th>
              <th>Status</th>
              <th>Waktu</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            {allOrders.map((order) => (
              <tr data-status={order.status} data-kelompok={order.kelompok} data-order-id={order.id} class="order-row">
                <td class="td-check">
                  <input type="checkbox" class="order-checkbox" value={order.id} />
                </td>
                <td><code>{order.orderNumber}</code></td>
                <td>
                  <strong>{order.customerName}</strong>
                  <br/><small class="text-muted">{order.whatsappNumber}</small>
                </td>
                <td><span class="badge badge-neutral">{order.kelompok}</span></td>
                <td>
                  <div class="items-mini">
                    {(order.items as any[] || []).map((item: any) => (
                      <small>‚Ä¢ {item.productName} √ó{item.quantity}</small>
                    ))}
                  </div>
                </td>
                <td class="text-accent"><strong>Rp {(order.totalAmount || 0).toLocaleString('id-ID')}</strong></td>
                <td>{order.waSent ? '‚úÖ' : '‚ùå'}</td>
                <td>
                  <span class={`badge badge-${statusColors[order.status] || 'neutral'}`}>
                    {statusLabels[order.status] || order.status}
                  </span>
                </td>
                <td class="text-muted" style="white-space:nowrap;">
                  {new Date(order.createdAt).toLocaleDateString('id-ID', { day: '2-digit', month: 'short' })}
                </td>
                <td>
                  <div class="action-group">
                    <select class="status-select" data-order-id={order.id} data-current={order.status}>
                      <option value="pending" selected={order.status === 'pending'}>Menunggu</option>
                      <option value="confirmed" selected={order.status === 'confirmed'}>Dikonfirmasi</option>
                      <option value="processing" selected={order.status === 'processing'}>Diproses</option>
                      <option value="completed" selected={order.status === 'completed'}>Selesai</option>
                      <option value="cancelled" selected={order.status === 'cancelled'}>Dibatalkan</option>
                    </select>
                    <button class="delete-btn" data-order-id={order.id} title="Hapus pesanan">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                    </button>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* Mobile Cards */}
      <div class="mobile-view">
        {allOrders.map((order) => (
          <div class="order-card" data-status={order.status} data-kelompok={order.kelompok} data-order-id={order.id}>
            <div class="oc-header">
              <div class="oc-header-left">
                <input type="checkbox" class="order-checkbox" value={order.id} />
                <div class="oc-customer">
                  <strong>{order.customerName}</strong>
                  <span class="text-muted">{order.whatsappNumber}</span>
                </div>
              </div>
              <span class={`badge badge-${statusColors[order.status] || 'neutral'}`}>
                {statusLabels[order.status] || order.status}
              </span>
            </div>
            <div class="oc-body">
              <div class="oc-items">
                {(order.items as any[] || []).map((item: any) => (
                  <small>‚Ä¢ {item.productName} √ó{item.quantity}</small>
                ))}
              </div>
            </div>
            <div class="oc-footer">
              <div class="oc-meta-row">
                <code>{order.orderNumber}</code>
                <span class="badge badge-neutral">{order.kelompok}</span>
                <small class="text-muted">{new Date(order.createdAt).toLocaleDateString('id-ID', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' })}</small>
              </div>
              <div class="oc-action-row">
                <span class="oc-total">Rp {(order.totalAmount || 0).toLocaleString('id-ID')}</span>
                <div class="oc-action-btns">
                  <select class="status-select-mobile" data-order-id={order.id} data-current={order.status}>
                    <option value="pending" selected={order.status === 'pending'}>Menunggu</option>
                    <option value="confirmed" selected={order.status === 'confirmed'}>Dikonfirmasi</option>
                    <option value="processing" selected={order.status === 'processing'}>Diproses</option>
                    <option value="completed" selected={order.status === 'completed'}>Selesai</option>
                    <option value="cancelled" selected={order.status === 'cancelled'}>Dibatalkan</option>
                  </select>
                  <button class="delete-btn-mobile" data-order-id={order.id} title="Hapus">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
      <!-- No Results Message -->
      <div class="no-results-card" id="noResultsCard" style="display:none;">
        <div class="empty-icon">üîç</div>
        <p>Tidak ada pesanan ditemukan</p>
        <small>Coba ubah kata kunci pencarian atau filter</small>
      </div>

      <!-- Pagination Controls -->
      <div class="pagination-bar" id="paginationBar">
        <div class="pagination-left">
          <span class="pagination-info" id="paginationInfo"></span>
        </div>
        <div class="pagination-center">
          <button class="page-btn" id="pageFirst" title="Halaman pertama">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="11 17 6 12 11 7"/><polyline points="18 17 13 12 18 7"/></svg>
          </button>
          <button class="page-btn" id="pagePrev" title="Sebelumnya">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg>
          </button>
          <div class="page-numbers" id="pageNumbers"></div>
          <button class="page-btn" id="pageNext" title="Berikutnya">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg>
          </button>
          <button class="page-btn" id="pageLast" title="Halaman terakhir">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="13 17 18 12 13 7"/><polyline points="6 17 11 12 6 7"/></svg>
          </button>
        </div>
        <div class="pagination-right">
          <select class="per-page-select" id="perPageSelect">
            <option value="10">10 / hal</option>
            <option value="25" selected>25 / hal</option>
            <option value="50">50 / hal</option>
            <option value="0">Semua</option>
          </select>
        </div>
      </div>
    </>
  ) : (
    <div class="empty-state-card">
      <div class="empty-icon">üì¶</div>
      <p>Belum ada pesanan masuk</p>
      <small>Pesanan dari pelanggan akan muncul di sini</small>
    </div>
  )}

  <!-- Delete Confirm Modal -->
  <div class="confirm-overlay" id="confirmOverlay">
    <div class="confirm-modal">
      <div class="confirm-icon">üóëÔ∏è</div>
      <h3 id="confirmTitle">Hapus Pesanan?</h3>
      <p id="confirmDesc">Pesanan yang dihapus tidak dapat dikembalikan.</p>
      <div class="confirm-actions">
        <button class="btn btn-secondary" id="confirmCancel">Batal</button>
        <button class="btn btn-danger" id="confirmDelete">Ya, Hapus</button>
      </div>
    </div>
  </div>
</AdminLayout>

<script>
  // ===== STATE =====
  let activeStatusFilter = 'all';
  let activeKelompokFilter = 'all';
  let searchQuery = '';
  let selectedIds = new Set();
  let pendingDeleteIds = [];
  let currentPage = 1;
  let perPage = 25;

  // ===== SEARCH LOGIC =====
  function getSearchableText(el) {
    return (el.textContent || '').toLowerCase();
  }

  function matchesSearch(el) {
    if (!searchQuery) return true;
    const text = getSearchableText(el);
    const terms = searchQuery.toLowerCase().split(/\s+/).filter(Boolean);
    return terms.every(term => text.includes(term));
  }

  // ===== FILTER LOGIC =====
  function isRowVisible(el) {
    const status = el.dataset.status;
    const kelompok = el.dataset.kelompok;
    const matchStatus = activeStatusFilter === 'all' || status === activeStatusFilter;
    const matchKelompok = activeKelompokFilter === 'all' || kelompok === activeKelompokFilter;
    return matchStatus && matchKelompok && matchesSearch(el);
  }

  function getFilteredElements(selector) {
    return [...document.querySelectorAll(selector)].filter(el => isRowVisible(el));
  }

  function applyFilters() {
    const desktopRows = [...document.querySelectorAll('#ordersTable tbody tr')];
    const mobileCards = [...document.querySelectorAll('.order-card')];

    // First pass: mark filtered (matching filters + search)
    const filteredDesktop = desktopRows.filter(r => isRowVisible(r));
    const filteredMobile = mobileCards.filter(c => isRowVisible(c));
    const totalFiltered = filteredDesktop.length;

    // Calculate pagination
    const effectivePerPage = perPage === 0 ? totalFiltered : perPage;
    const totalPages = effectivePerPage > 0 ? Math.max(1, Math.ceil(totalFiltered / effectivePerPage)) : 1;
    if (currentPage > totalPages) currentPage = totalPages;
    if (currentPage < 1) currentPage = 1;

    const startIndex = (currentPage - 1) * effectivePerPage;
    const endIndex = perPage === 0 ? totalFiltered : startIndex + effectivePerPage;

    // Apply visibility: Desktop
    let visibleIdx = 0;
    desktopRows.forEach(row => {
      if (isRowVisible(row)) {
        const inPage = visibleIdx >= startIndex && visibleIdx < endIndex;
        row.style.display = inPage ? '' : 'none';
        row.dataset.paginated = inPage ? 'true' : 'false';
        visibleIdx++;
      } else {
        row.style.display = 'none';
        row.dataset.paginated = 'false';
      }
    });

    // Apply visibility: Mobile
    visibleIdx = 0;
    mobileCards.forEach(card => {
      if (isRowVisible(card)) {
        const inPage = visibleIdx >= startIndex && visibleIdx < endIndex;
        card.style.display = inPage ? '' : 'none';
        card.dataset.paginated = inPage ? 'true' : 'false';
        visibleIdx++;
      } else {
        card.style.display = 'none';
        card.dataset.paginated = 'false';
      }
    });

    // Update pagination UI
    updatePagination(totalFiltered, totalPages, startIndex, endIndex);

    // Show/hide no results
    const noResultsCard = document.getElementById('noResultsCard');
    if (noResultsCard) {
      noResultsCard.style.display = totalFiltered === 0 ? '' : 'none';
    }

    // Update search result info
    const searchInfo = document.getElementById('searchResultInfo');
    if (searchInfo) {
      if (searchQuery) {
        searchInfo.style.display = '';
        searchInfo.textContent = `${totalFiltered} hasil ditemukan untuk "${searchQuery}"`;
      } else {
        searchInfo.style.display = 'none';
      }
    }

    updateBulkBar();
  }

  // ===== PAGINATION =====
  function updatePagination(totalFiltered, totalPages, startIndex, endIndex) {
    const paginationBar = document.getElementById('paginationBar');
    if (!paginationBar) return;

    // Info text
    const infoEl = document.getElementById('paginationInfo');
    if (infoEl) {
      if (totalFiltered === 0) {
        infoEl.textContent = '0 pesanan';
      } else {
        const showEnd = Math.min(endIndex, totalFiltered);
        infoEl.textContent = `${startIndex + 1}‚Äì${showEnd} dari ${totalFiltered} pesanan`;
      }
    }

    // Page numbers
    const pageNumContainer = document.getElementById('pageNumbers');
    if (pageNumContainer) {
      pageNumContainer.innerHTML = '';
      const maxVisible = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
      let endPage = Math.min(totalPages, startPage + maxVisible - 1);
      if (endPage - startPage < maxVisible - 1) {
        startPage = Math.max(1, endPage - maxVisible + 1);
      }

      if (startPage > 1) {
        const dots = document.createElement('span');
        dots.className = 'page-dots';
        dots.textContent = '...';
        pageNumContainer.appendChild(dots);
      }

      for (let i = startPage; i <= endPage; i++) {
        const btn = document.createElement('button');
        btn.className = 'page-num' + (i === currentPage ? ' active' : '');
        btn.textContent = i.toString();
        btn.addEventListener('click', () => {
          currentPage = i;
          applyFilters();
          scrollToTop();
        });
        pageNumContainer.appendChild(btn);
      }

      if (endPage < totalPages) {
        const dots = document.createElement('span');
        dots.className = 'page-dots';
        dots.textContent = '...';
        pageNumContainer.appendChild(dots);
      }
    }

    // Button states
    const firstBtn = document.getElementById('pageFirst');
    const prevBtn = document.getElementById('pagePrev');
    const nextBtn = document.getElementById('pageNext');
    const lastBtn = document.getElementById('pageLast');

    if (firstBtn) firstBtn.disabled = currentPage <= 1;
    if (prevBtn) prevBtn.disabled = currentPage <= 1;
    if (nextBtn) nextBtn.disabled = currentPage >= totalPages;
    if (lastBtn) lastBtn.disabled = currentPage >= totalPages;

    // Hide pagination if only 1 page and showing all
    paginationBar.style.display = (totalPages <= 1 && perPage === 0) ? 'none' : '';
  }

  function scrollToTop() {
    document.querySelector('.search-bar')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // Pagination button events
  document.getElementById('pageFirst')?.addEventListener('click', () => { currentPage = 1; applyFilters(); scrollToTop(); });
  document.getElementById('pagePrev')?.addEventListener('click', () => { if (currentPage > 1) { currentPage--; applyFilters(); scrollToTop(); } });
  document.getElementById('pageNext')?.addEventListener('click', () => { currentPage++; applyFilters(); scrollToTop(); });
  document.getElementById('pageLast')?.addEventListener('click', () => {
    const totalFiltered = getFilteredElements('#ordersTable tbody tr').length;
    const effectivePerPage = perPage === 0 ? totalFiltered : perPage;
    currentPage = Math.max(1, Math.ceil(totalFiltered / effectivePerPage));
    applyFilters();
    scrollToTop();
  });

  // Per page change
  document.getElementById('perPageSelect')?.addEventListener('change', (e) => {
    perPage = parseInt(e.target.value);
    currentPage = 1;
    applyFilters();
  });

  // ===== SEARCH EVENTS =====
  let searchTimeout;
  const searchInput = document.getElementById('searchInput');
  const searchClearBtn = document.getElementById('searchClearBtn');

  searchInput?.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      searchQuery = e.target.value.trim();
      currentPage = 1;
      applyFilters();
      if (searchClearBtn) searchClearBtn.style.display = searchQuery ? '' : 'none';
    }, 250);
  });

  searchClearBtn?.addEventListener('click', () => {
    if (searchInput) searchInput.value = '';
    searchQuery = '';
    currentPage = 1;
    if (searchClearBtn) searchClearBtn.style.display = 'none';
    applyFilters();
    searchInput?.focus();
  });

  // Status filter chips
  document.querySelectorAll('.filter-chip').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-chip').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeStatusFilter = btn.dataset.filter;
      currentPage = 1;
      applyFilters();
    });
  });

  // Kelompok filter
  document.getElementById('kelompokFilter')?.addEventListener('change', (e) => {
    activeKelompokFilter = e.target.value;
    currentPage = 1;
    applyFilters();
  });

  // ===== CHECKBOX / SELECTION =====
  function getVisibleCheckboxes() {
    return [...document.querySelectorAll('.order-checkbox')].filter(cb => {
      const container = cb.closest('[data-status]');
      return container && container.style.display !== 'none' && container.dataset.paginated === 'true';
    });
  }

  function updateBulkBar() {
    const bar = document.getElementById('bulkBar');
    const countEl = document.getElementById('bulkCount');
    const selectAllCb = document.getElementById('selectAllCheckbox');
    const desktopAllCb = document.getElementById('desktopCheckAll');

    // Sync checkboxes with selectedIds
    document.querySelectorAll('.order-checkbox').forEach(cb => {
      cb.checked = selectedIds.has(parseInt(cb.value));
    });

    if (bar) bar.classList.toggle('visible', selectedIds.size > 0);
    if (countEl) countEl.textContent = `${selectedIds.size} dipilih`;

    // Update "select all" checkboxes
    const visibleCbs = getVisibleCheckboxes();
    const allChecked = visibleCbs.length > 0 && visibleCbs.every(cb => cb.checked);
    if (selectAllCb) selectAllCb.checked = allChecked;
    if (desktopAllCb) desktopAllCb.checked = allChecked;
  }

  // Individual checkbox change
  document.querySelectorAll('.order-checkbox').forEach(cb => {
    cb.addEventListener('change', () => {
      const id = parseInt(cb.value);
      if (cb.checked) selectedIds.add(id);
      else selectedIds.delete(id);
      updateBulkBar();
    });
  });

  // Select All (bulk bar)
  document.getElementById('selectAllCheckbox')?.addEventListener('change', (e) => {
    const checked = e.target.checked;
    getVisibleCheckboxes().forEach(cb => {
      const id = parseInt(cb.value);
      if (checked) selectedIds.add(id);
      else selectedIds.delete(id);
      cb.checked = checked;
    });
    updateBulkBar();
  });

  // Select All (desktop table header)
  document.getElementById('desktopCheckAll')?.addEventListener('change', (e) => {
    const checked = e.target.checked;
    getVisibleCheckboxes().forEach(cb => {
      const id = parseInt(cb.value);
      if (checked) selectedIds.add(id);
      else selectedIds.delete(id);
      cb.checked = checked;
    });
    updateBulkBar();
  });

  // ===== DELETE LOGIC =====
  function showConfirm(title, desc, ids) {
    pendingDeleteIds = ids;
    document.getElementById('confirmTitle').textContent = title;
    document.getElementById('confirmDesc').textContent = desc;
    document.getElementById('confirmOverlay')?.classList.add('open');
  }

  function hideConfirm() {
    document.getElementById('confirmOverlay')?.classList.remove('open');
    pendingDeleteIds = [];
  }

  // Single delete buttons
  document.querySelectorAll('.delete-btn, .delete-btn-mobile').forEach(btn => {
    btn.addEventListener('click', () => {
      const orderId = parseInt(btn.dataset.orderId);
      showConfirm('Hapus Pesanan?', 'Pesanan ini akan dihapus permanen dan tidak dapat dikembalikan.', [orderId]);
    });
  });

  // Bulk delete button
  document.getElementById('bulkDeleteBtn')?.addEventListener('click', () => {
    if (selectedIds.size === 0) return;
    showConfirm(
      `Hapus ${selectedIds.size} Pesanan?`,
      `${selectedIds.size} pesanan yang dipilih akan dihapus permanen.`,
      [...selectedIds]
    );
  });

  // Cancel button
  document.getElementById('confirmCancel')?.addEventListener('click', hideConfirm);
  document.getElementById('confirmOverlay')?.addEventListener('click', (e) => {
    if (e.target === e.currentTarget) hideConfirm();
  });

  // Confirm delete
  document.getElementById('confirmDelete')?.addEventListener('click', async () => {
    if (pendingDeleteIds.length === 0) return;
    const btn = document.getElementById('confirmDelete');
    if (btn) { btn.textContent = 'Menghapus...'; btn.disabled = true; }

    try {
      const res = await fetch('/api/orders', {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ids: pendingDeleteIds }),
      });
      const result = await res.json();
      if (result.success) {
        // Remove rows/cards from DOM
        pendingDeleteIds.forEach(id => {
          document.querySelectorAll(`[data-order-id="${id}"]`).forEach(el => {
            if (el.tagName === 'TR' || el.classList.contains('order-card')) {
              el.style.transition = 'opacity 0.3s, transform 0.3s';
              el.style.opacity = '0';
              el.style.transform = 'translateX(20px)';
              setTimeout(() => el.remove(), 300);
            }
          });
          selectedIds.delete(id);
        });
        window.showToast?.(`${result.deleted} pesanan dihapus`);
        // Re-apply filters after deletion to fix pagination
        setTimeout(() => applyFilters(), 350);
      } else {
        window.showToast?.(result.message || 'Gagal menghapus', 'error');
      }
    } catch {
      window.showToast?.('Terjadi kesalahan', 'error');
    } finally {
      hideConfirm();
      if (btn) { btn.textContent = 'Ya, Hapus'; btn.disabled = false; }
    }
  });

  // ===== STATUS UPDATE =====
  document.querySelectorAll('.status-select, .status-select-mobile').forEach(select => {
    select.addEventListener('change', async () => {
      const orderId = parseInt(select.dataset.orderId);
      const newStatus = select.value;
      try {
        const res = await fetch('/api/orders', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: orderId, status: newStatus }),
        });
        const result = await res.json();
        if (result.success) {
          window.showToast?.('Status pesanan diperbarui');
          document.querySelectorAll(`[data-order-id="${orderId}"]`).forEach(el => {
            if (el.dataset.status !== undefined) el.dataset.status = newStatus;
          });
        } else { window.showToast?.('Gagal memperbarui', 'error'); }
      } catch { window.showToast?.('Terjadi kesalahan', 'error'); }
    });
  });

  // ===== INITIAL RENDER =====
  applyFilters();
</script>

<style>
  /* ===== SEARCH BAR ===== */
  .search-bar {
    margin-bottom: 16px;
  }

  .search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  .search-icon {
    position: absolute;
    left: 16px;
    color: var(--color-text-muted);
    pointer-events: none;
    transition: color 0.2s;
  }

  .search-input {
    width: 100%;
    padding: 12px 44px 12px 46px;
    font-size: 0.88rem;
    font-family: var(--font-body);
    font-weight: 500;
    background: white;
    border: 1.5px solid var(--color-border);
    color: var(--color-text-primary);
    border-radius: var(--radius-xl);
    outline: none;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-xs);
  }

  .search-input::placeholder {
    color: var(--color-text-muted);
    font-weight: 400;
  }

  .search-input:focus {
    border-color: var(--color-accent);
    box-shadow: 0 0 0 4px var(--color-accent-subtle), var(--shadow-sm);
  }

  .search-input:focus ~ .search-icon,
  .search-input:not(:placeholder-shown) ~ .search-icon {
    /* icon color hint when active - won't work with sibling since icon is before; handled via JS */
  }

  .search-input-wrapper:focus-within .search-icon {
    color: var(--color-accent);
  }

  .search-clear-btn {
    position: absolute;
    right: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    background: var(--color-bg-tertiary);
    border: none;
    border-radius: 50%;
    color: var(--color-text-muted);
    cursor: pointer;
    transition: all 0.15s;
  }

  .search-clear-btn:hover {
    background: var(--color-border);
    color: var(--color-text-primary);
  }

  .search-result-info {
    font-size: 0.78rem;
    color: var(--color-text-muted);
    margin-top: 8px;
    padding-left: 4px;
    font-weight: 500;
  }

  /* ===== FILTERS BAR ===== */
  .filters-bar {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 14px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }

  .filters-left { flex: 1; min-width: 0; }
  .filters-right { flex-shrink: 0; }

  .orders-filters {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .filter-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 14px;
    font-size: 0.78rem;
    font-weight: 600;
    font-family: var(--font-body);
    background: white;
    border: 1px solid var(--color-border);
    color: var(--color-text-secondary);
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: all 0.15s;
    box-shadow: var(--shadow-xs);
    white-space: nowrap;
  }

  .filter-chip:hover { border-color: var(--color-border-hover); color: var(--color-accent); }

  .filter-chip.active {
    background: var(--gradient-primary);
    border-color: var(--color-accent);
    color: white;
    box-shadow: var(--shadow-accent);
  }

  .filter-count {
    background: rgba(255,255,255,0.2);
    padding: 1px 6px;
    border-radius: 10px;
    font-size: 0.7rem;
  }

  .filter-chip:not(.active) .filter-count {
    background: var(--color-bg-tertiary);
    color: var(--color-text-muted);
  }

  /* Kelompok Filter */
  .kelompok-filter {
    padding: 8px 14px;
    font-size: 0.82rem;
    font-family: var(--font-body);
    font-weight: 600;
    background: white;
    border: 1px solid var(--color-border);
    color: var(--color-text-primary);
    border-radius: var(--radius-full);
    cursor: pointer;
    outline: none;
    transition: all 0.15s;
    box-shadow: var(--shadow-xs);
  }

  .kelompok-filter:focus {
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px var(--color-accent-subtle);
  }

  /* ===== BULK ACTION BAR ===== */
  .bulk-bar {
    background: linear-gradient(135deg, #4F46E5, #7C3AED);
    border-radius: var(--radius-lg);
    padding: 0;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    margin-bottom: 0;
    transition: all 0.3s ease;
  }

  .bulk-bar.visible {
    max-height: 80px;
    opacity: 1;
    padding: 12px 18px;
    margin-bottom: 16px;
  }

  .bulk-bar-inner {
    display: flex;
    align-items: center;
    gap: 16px;
    color: white;
  }

  .bulk-select-all-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.82rem;
    font-weight: 600;
    cursor: pointer;
    white-space: nowrap;
  }

  .bulk-select-all-label input[type="checkbox"] {
    width: 16px; height: 16px;
    accent-color: white;
    cursor: pointer;
  }

  .bulk-count {
    font-size: 0.82rem;
    font-weight: 700;
    opacity: 0.9;
    flex: 1;
  }

  .btn-danger-outline {
    background: rgba(255,255,255,0.15);
    color: white;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 6px 14px;
    font-size: 0.78rem;
    font-weight: 700;
    font-family: var(--font-body);
    border-radius: var(--radius-md);
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .btn-danger-outline:hover {
    background: rgba(239,68,68,0.9);
    border-color: rgba(239,68,68,0.9);
  }

  /* ===== TABLE CHECKBOXES ===== */
  .th-check, .td-check { width: 40px; text-align: center; }
  .th-check input, .td-check input {
    width: 16px; height: 16px;
    accent-color: var(--color-accent);
    cursor: pointer;
  }

  /* ===== ACTION GROUP ===== */
  .action-group {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .delete-btn, .delete-btn-mobile {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px; height: 32px;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    color: var(--color-text-muted);
    cursor: pointer;
    transition: all 0.15s;
    flex-shrink: 0;
  }

  .delete-btn:hover, .delete-btn-mobile:hover {
    background: rgba(239,68,68,0.06);
    border-color: rgba(239,68,68,0.3);
    color: var(--color-danger);
  }

  .items-mini {
    display: flex;
    flex-direction: column;
    gap: 1px;
    max-width: 200px;
  }
  .items-mini small { font-size: 0.73rem; color: var(--color-text-muted); }

  .status-select, .status-select-mobile {
    padding: 6px 10px;
    font-size: 0.78rem;
    font-family: var(--font-body);
    background: white;
    border: 1px solid var(--color-border-strong);
    color: var(--color-text-primary);
    border-radius: var(--radius-sm);
    cursor: pointer;
    outline: none;
    transition: border-color 0.15s;
  }
  .status-select:focus, .status-select-mobile:focus { border-color: var(--color-accent); box-shadow: 0 0 0 3px var(--color-accent-subtle); }

  .empty-state-card, .no-results-card {
    text-align: center;
    padding: 48px 24px;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-card);
  }
  .empty-icon { font-size: 2.5rem; opacity: 0.3; margin-bottom: 12px; }
  .empty-state-card p, .no-results-card p { font-weight: 600; color: var(--color-text-secondary); }
  .no-results-card small { color: var(--color-text-muted); }

  code {
    font-size: 0.73rem;
    background: var(--color-bg-tertiary);
    padding: 2px 8px;
    border-radius: var(--radius-sm);
    font-family: 'SF Mono', Monaco, monospace;
  }

  /* ===== PAGINATION ===== */
  .pagination-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    margin-top: 20px;
    padding: 14px 20px;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xs);
    flex-wrap: wrap;
  }

  .pagination-left { flex-shrink: 0; }

  .pagination-info {
    font-size: 0.8rem;
    color: var(--color-text-muted);
    font-weight: 600;
    white-space: nowrap;
  }

  .pagination-center {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .page-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 34px;
    height: 34px;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.15s;
    font-family: var(--font-body);
  }

  .page-btn:hover:not(:disabled) {
    border-color: var(--color-accent);
    color: var(--color-accent);
    background: var(--color-accent-subtle);
  }

  .page-btn:disabled {
    opacity: 0.35;
    cursor: not-allowed;
  }

  .page-numbers {
    display: flex;
    align-items: center;
    gap: 2px;
  }

  .page-num {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 34px;
    height: 34px;
    padding: 0 6px;
    background: transparent;
    border: 1px solid transparent;
    border-radius: var(--radius-md);
    color: var(--color-text-secondary);
    font-size: 0.82rem;
    font-weight: 600;
    font-family: var(--font-body);
    cursor: pointer;
    transition: all 0.15s;
  }

  .page-num:hover {
    background: var(--color-bg-tertiary);
    border-color: var(--color-border);
  }

  .page-num.active {
    background: var(--gradient-primary);
    color: white;
    border-color: var(--color-accent);
    box-shadow: var(--shadow-accent);
    cursor: default;
  }

  .page-dots {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 24px;
    height: 34px;
    font-size: 0.82rem;
    color: var(--color-text-muted);
    font-weight: 600;
    user-select: none;
  }

  .pagination-right { flex-shrink: 0; }

  .per-page-select {
    padding: 8px 12px;
    font-size: 0.8rem;
    font-family: var(--font-body);
    font-weight: 600;
    background: white;
    border: 1px solid var(--color-border);
    color: var(--color-text-primary);
    border-radius: var(--radius-md);
    cursor: pointer;
    outline: none;
    transition: all 0.15s;
  }

  .per-page-select:focus {
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px var(--color-accent-subtle);
  }

  /* ===== CONFIRM MODAL ===== */
  .confirm-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(6px);
    z-index: 5000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
    padding: 24px;
  }

  .confirm-overlay.open {
    opacity: 1;
    pointer-events: all;
  }

  .confirm-modal {
    background: white;
    border-radius: var(--radius-xl);
    padding: 32px;
    max-width: 380px;
    width: 100%;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    animation: modalIn 0.3s ease;
  }

  @keyframes modalIn {
    from { transform: scale(0.9); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .confirm-icon { font-size: 2.5rem; margin-bottom: 12px; }
  .confirm-modal h3 { font-size: 1.1rem; font-weight: 800; margin-bottom: 8px; }
  .confirm-modal p { font-size: 0.88rem; color: var(--color-text-secondary); margin-bottom: 24px; line-height: 1.5; }

  .confirm-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  .confirm-actions .btn {
    padding: 10px 24px;
    font-size: 0.85rem;
    border-radius: var(--radius-md);
    font-weight: 700;
    cursor: pointer;
    border: none;
    transition: all 0.15s;
  }

  .btn-secondary {
    background: var(--color-bg-tertiary);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
  }
  .btn-secondary:hover { background: var(--color-border); }

  .btn-danger {
    background: linear-gradient(135deg, #DC2626, #EF4444);
    color: white;
    box-shadow: 0 4px 12px rgba(239,68,68,0.3);
  }
  .btn-danger:hover { box-shadow: 0 6px 16px rgba(239,68,68,0.4); }

  /* ===== MOBILE CARDS ===== */
  .mobile-view { display: none; }

  .order-card {
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: 14px;
    margin-bottom: 10px;
    transition: border-color 0.15s;
  }
  .order-card:hover { border-color: var(--color-border-hover); }

  .oc-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
  }

  .oc-header-left {
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }

  .oc-header-left input[type="checkbox"] {
    width: 16px; height: 16px;
    accent-color: var(--color-accent);
    cursor: pointer;
    margin-top: 3px;
    flex-shrink: 0;
  }

  .oc-customer {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  .oc-customer strong { font-size: 0.9rem; }
  .oc-customer .text-muted { font-size: 0.75rem; }

  .oc-body {
    padding-bottom: 10px;
    border-bottom: 1px solid var(--color-border);
    margin-bottom: 10px;
  }
  .oc-items {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  .oc-items small { font-size: 0.75rem; color: var(--color-text-muted); }

  .oc-meta-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 10px;
  }

  .oc-action-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .oc-action-btns {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .oc-total {
    font-family: var(--font-heading);
    font-weight: 800;
    font-size: 1rem;
    color: var(--color-accent);
  }

  .status-select-mobile {
    padding: 8px 12px;
    font-size: 0.82rem;
    border-radius: var(--radius-md);
  }

  .delete-btn-mobile {
    width: 36px; height: 36px;
    border-radius: var(--radius-md);
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 1024px) {
    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      margin-left: -20px;
      margin-right: -20px;
      padding-left: 20px;
      padding-right: 20px;
    }

    .table { min-width: 780px; }
  }

  @media (max-width: 768px) {
    /* Search */
    .search-bar {
      margin-bottom: 12px;
      max-width: 100%;
    }

    .search-input-wrapper {
      max-width: 100%;
    }

    .search-input {
      padding: 11px 40px 11px 42px;
      font-size: 0.84rem;
      border-radius: var(--radius-lg);
      width: 100%;
      box-sizing: border-box;
    }

    .search-icon { left: 14px; }
    .search-clear-btn { right: 10px; }

    /* Filters */
    .filters-bar {
      flex-direction: column;
      gap: 10px;
      margin-bottom: 12px;
    }

    .filters-left { width: 100%; }
    .filters-right { width: 100%; }

    .kelompok-filter {
      width: 100%;
      border-radius: var(--radius-md);
      padding: 10px 14px;
      font-size: 0.82rem;
    }

    .orders-filters {
      flex-wrap: nowrap;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      padding-bottom: 4px;
      margin-left: -16px;
      margin-right: -16px;
      padding-left: 16px;
      padding-right: 32px;
    }
    .orders-filters::-webkit-scrollbar { display: none; }

    .filter-chip {
      padding: 8px 12px;
      font-size: 0.75rem;
      flex-shrink: 0;
    }

    /* Show/hide views */
    .desktop-view { display: none; }
    .mobile-view { display: block; }

    /* Pagination */
    .pagination-bar {
      flex-direction: column;
      gap: 10px;
      padding: 12px 14px;
      align-items: stretch;
      text-align: center;
      margin-top: 14px;
    }

    .pagination-left {
      display: flex;
      justify-content: center;
    }

    .pagination-info {
      font-size: 0.76rem;
    }

    .pagination-center {
      justify-content: center;
      flex-wrap: wrap;
      gap: 3px;
    }

    .page-btn {
      width: 32px;
      height: 32px;
    }

    .page-num {
      min-width: 30px;
      height: 30px;
      font-size: 0.78rem;
    }

    .pagination-right {
      display: flex;
      justify-content: center;
    }

    .per-page-select {
      width: 100%;
      text-align: center;
      padding: 10px 12px;
    }

    /* Bulk bar */
    .bulk-bar.visible {
      padding: 10px 14px;
      margin-bottom: 12px;
    }

    .bulk-bar-inner {
      flex-wrap: wrap;
      gap: 8px;
    }

    .bulk-count { flex: none; font-size: 0.78rem; }

    .btn-danger-outline {
      font-size: 0.75rem;
      padding: 7px 12px;
      width: 100%;
      justify-content: center;
    }

    /* ===== MOBILE ORDER CARDS ===== */
    .order-card {
      padding: 0;
      margin-bottom: 12px;
      border-radius: var(--radius-xl);
      border-left: 4px solid var(--color-border);
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      max-width: 100%;
      overflow: hidden;
      word-break: break-word;
    }

    /* Status-colored left border */
    .order-card[data-status="pending"]   { border-left-color: #F59E0B; }
    .order-card[data-status="confirmed"] { border-left-color: #10B981; }
    .order-card[data-status="processing"]{ border-left-color: #3B82F6; }
    .order-card[data-status="completed"] { border-left-color: #8B5CF6; }
    .order-card[data-status="cancelled"] { border-left-color: #EF4444; }

    /* Hide status badge in header ‚Äî status is shown via select at bottom */
    .oc-header > .badge { display: none; }

    .oc-header {
      padding: 14px 16px 12px;
      gap: 10px;
      background: white;
      border-bottom: none;
    }

    .oc-header-left {
      gap: 10px;
      min-width: 0;
    }

    .oc-header-left input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }

    .oc-customer {
      min-width: 0;
    }

    .oc-customer strong {
      font-size: 0.92rem;
      font-weight: 700;
      word-break: break-word;
      display: block;
      color: var(--color-text-primary);
    }

    .oc-customer .text-muted {
      font-size: 0.76rem;
      margin-top: 2px;
    }

    .oc-body {
      padding: 4px 16px 12px;
      border-bottom: none;
      margin-bottom: 0;
    }

    .oc-items small {
      font-size: 0.78rem;
      line-height: 1.5;
      color: var(--color-text-secondary);
    }

    .oc-footer {
      padding: 0 16px 14px;
    }

    .oc-meta-row {
      gap: 8px;
      margin-bottom: 8px;
      padding-bottom: 0;
    }

    .oc-meta-row code {
      font-size: 0.7rem;
      padding: 3px 8px;
      background: var(--color-bg-tertiary);
      border-radius: var(--radius-sm);
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 180px;
    }

    /* Total ‚Äî right-aligned on its own row */
    .oc-action-row {
      flex-direction: column;
      align-items: stretch;
      gap: 10px;
    }

    .oc-total {
      text-align: right;
      font-size: 1.05rem;
      font-weight: 800;
      color: var(--color-accent);
      padding-bottom: 2px;
    }

    /* Action buttons row */
    .oc-action-btns {
      display: flex;
      gap: 0;
      width: 100%;
    }

    /* Hide delete button on mobile */
    .delete-btn-mobile {
      display: none;
    }

    /* Status select ‚Äî full width, rounded pill style */
    .status-select-mobile {
      width: 100%;
      max-width: none;
      padding: 12px 16px;
      font-size: 0.85rem;
      font-weight: 600;
      border-radius: var(--radius-xl);
      border: 1.5px solid var(--color-border);
      background: var(--color-bg-secondary);
      color: var(--color-text-primary);
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239CA3AF' stroke-width='2.5'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      cursor: pointer;
      transition: all 0.15s;
    }

    .status-select-mobile:focus {
      border-color: var(--color-accent);
      box-shadow: 0 0 0 3px var(--color-accent-subtle);
      background-color: white;
    }

    /* No results */
    .no-results-card, .empty-state-card {
      padding: 36px 20px;
    }
    .empty-icon { font-size: 2rem; }

    /* Confirm modal mobile */
    .confirm-overlay {
      padding: 16px;
    }

    .confirm-modal {
      padding: 24px;
    }

    .confirm-modal h3 {
      font-size: 1rem;
    }

    .confirm-modal p {
      font-size: 0.82rem;
    }

    .confirm-actions {
      flex-direction: column;
    }

    .confirm-actions .btn {
      width: 100%;
      justify-content: center;
    }
  }

  @media (max-width: 480px) {
    .page-btn {
      width: 30px;
      height: 30px;
    }

    .page-num {
      min-width: 28px;
      height: 28px;
      font-size: 0.75rem;
    }

    .oc-header {
      padding: 12px 14px 10px;
    }

    .oc-footer {
      padding: 0 14px 12px;
    }

    .oc-body {
      padding: 4px 14px 10px;
    }

    .status-select-mobile {
      padding: 11px 14px;
      font-size: 0.82rem;
    }
  }

  @media (max-width: 380px) {
    .order-card {
      border-radius: var(--radius-lg);
    }

    .oc-header {
      padding: 10px 12px 8px;
    }

    .oc-body {
      padding: 4px 12px 8px;
    }

    .oc-footer {
      padding: 0 12px 10px;
    }

    .oc-meta-row {
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
    }

    .filter-chip {
      padding: 6px 10px;
      font-size: 0.72rem;
    }

    .bulk-bar.visible {
      padding: 10px 12px;
    }

    .bulk-select-all-label {
      font-size: 0.78rem;
    }

    .btn-danger-outline {
      font-size: 0.72rem;
      padding: 6px 10px;
    }

    .search-input {
      font-size: 0.8rem;
      padding: 10px 36px 10px 38px;
    }

    .pagination-center {
      gap: 2px;
    }

    .page-btn { width: 28px; height: 28px; }
    .page-num { min-width: 26px; height: 26px; font-size: 0.72rem; }
  }
</style>
